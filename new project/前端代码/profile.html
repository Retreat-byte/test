<!DOCTYPE html>
<html lang="zh-CN">
	<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - æƒ…ç»ªå²›</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	</head>
	<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-island-tropical"></i>
                <span>æƒ…ç»ªå²›</span>
                <small>å®ˆæŠ¤å¿ƒçµçš„æ¸¯æ¹¾</small>
            </div>
            <nav class="nav">
                <a href="home.html" class="nav-link">
                    <i class="fas fa-home"></i> é¦–é¡µ
                </a>
                <a href="ai-chat.html" class="nav-link">
                    <i class="fas fa-comments"></i> AIå¯¹è¯
                </a>
                <a href="tools.html" class="nav-link">
                    <i class="fas fa-toolbox"></i> å¿ƒç†å·¥å…·
                </a>
                <a href="profile.html" class="nav-link active">
                    <i class="fas fa-user"></i> ä¸ªäººä¸­å¿ƒ
                </a>
            </nav>
            <div class="user-info">
                <button class="btn-login" id="loginBtn">ç™»å½•</button>
                <div class="user-profile" id="userProfile" style="display: none;">
                    <div class="user-avatar" id="headerAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-details">
                        <span class="user-nickname" id="headerNickname">ç”¨æˆ·</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="user-dropdown">
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i> ä¸ªäººä¸­å¿ƒ
                        </a>
                        <a href="#" class="dropdown-item" id="headerLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <!-- ä¸ªäººä¸­å¿ƒé¡µ -->
        <section id="profile" class="page active">
            <!-- é¡¶éƒ¨ä¿¡æ¯åŒº -->
            <div class="profile-top">
                <div class="profile-header-new">
                    <div class="profile-info">
                        <div class="profile-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <h2>æˆ‘çš„æƒ…ç»ªå²›</h2>
                            <p>æƒ…ç»ªå²›å·²é™ªä¼´ä½  <span class="highlight">15</span> å¤©</p>
                        </div>
                    </div>
                    <button class="btn-settings"><i class="fas fa-cog"></i> è®¾ç½®</button>
                </div>

                <div class="profile-stats-new">
                    <div class="stat-card-new">
                        <div class="stat-icon blue">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">28</div>
                            <div class="stat-label">æ‰“å¡å¤©æ•°</div>
                        </div>
                    </div>
                    <div class="stat-card-new">
                        <div class="stat-icon purple">
                            <i class="fas fa-dumbbell"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">156</div>
                            <div class="stat-label">ç»ƒä¹ æ¬¡æ•°</div>
                        </div>
                    </div>
                    <div class="stat-card-new">
                        <div class="stat-icon green">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">8</div>
                            <div class="stat-label">å®Œæˆæµ‹è¯„</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹ç½‘æ ¼ (å·¦å³å¸ƒå±€) -->
            <div class="profile-grid">
                <!-- å·¦ä¾§ä¸»è¦å†…å®¹ -->
                <div class="profile-main">
                    <!-- æƒ…ç»ªè¶‹åŠ¿å›¾ -->
                    <div class="emotion-chart-section">
                        <div class="section-header">
                            <h2>æƒ…ç»ªè¶‹åŠ¿</h2>
                            <div class="chart-tabs">
                                <button class="tab-btn active" data-period="week">å‘¨è§†å›¾</button>
                                <button class="tab-btn" data-period="month">æœˆè§†å›¾</button>
                            </div>
                        </div>
                        <div class="chart-container" style="height: 450px;">
                            <canvas id="emotionChart"></canvas>
                        </div>
                        <div class="emotion-summary">
                            <div class="summary-item">
                                <span class="label">å¹³å‡å¿ƒæƒ…</span>
                                <span class="value" id="averageMood">---</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">æœ€ä½³çŠ¶æ€</span>
                                <span class="value" id="bestMood">---</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">æ”¹å–„è¶‹åŠ¿</span>
                                <span class="value" id="trendMood">---</span>
                            </div>
                        </div>
                    </div>

                    <!-- å†å²è®°å½• -->
                    <div class="history-section">
                        <h2>å†å²è®°å½•</h2>
                        <div class="history-tabs">
                            <button class="history-tab active" data-type="practice">ç»ƒä¹ å†å²</button>
                            <button class="history-tab" data-type="assessment">æµ‹è¯„æŠ¥å‘Š</button>
                        </div>
                        
                        <div class="history-content" id="practiceHistory">
                            <div class="history-item">
                                <div class="history-icon blue">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="history-info">
                                    <h3>æ­£å¿µå‘¼å¸</h3>
                                    <p>2024-12-17 08:30</p>
                                </div>
                                <div class="history-duration">10åˆ†é’Ÿ</div>
                            </div>
                            <div class="history-item">
                                <div class="history-icon purple">
                                    <i class="fas fa-om"></i>
                                </div>
                                <div class="history-info">
                                    <h3>æ™¨é—´å†¥æƒ³</h3>
                                    <p>2024-12-16 07:00</p>
                                </div>
                                <div class="history-duration">15åˆ†é’Ÿ</div>
                            </div>
                            <div class="history-item">
                                <div class="history-icon green">
                                    <i class="fas fa-moon"></i>
                                </div>
                                <div class="history-info">
                                    <h3>ç¡å‰å†¥æƒ³</h3>
                                    <p>2024-12-15 22:30</p>
                                </div>
                                <div class="history-duration">20åˆ†é’Ÿ</div>
                            </div>
                            <div class="history-item">
                                <div class="history-icon blue">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="history-info">
                                    <h3>æ­£å¿µå‘¼å¸</h3>
                                    <p>2024-12-14 19:00</p>
                                </div>
                                <div class="history-duration">8åˆ†é’Ÿ</div>
                            </div>
                            <div class="history-item">
                                <div class="history-icon purple">
                                    <i class="fas fa-om"></i>
                                </div>
                                <div class="history-info">
                                    <h3>æ£®æ—å†¥æƒ³</h3>
                                    <p>2024-12-13 14:30</p>
                                </div>
                                <div class="history-duration">10åˆ†é’Ÿ</div>
                            </div>
                        </div>
                        
                        <div class="history-content" id="assessmentHistory" style="display: none;">
                            <div class="history-item">
                                <div class="history-icon pink">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="history-info">
                                    <h3>æŠ‘éƒç—‡ç­›æŸ¥é‡è¡¨</h3>
                                    <p>2024-12-10 14:20</p>
                                </div>
                                <button class="btn-view" type="button" data-report-type="sds" data-report-date="2024-12-10 14:20">æŸ¥çœ‹æŠ¥å‘Š</button>
                            </div>
                            <div class="history-item">
                                <div class="history-icon pink">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="history-info">
                                    <h3>ç„¦è™‘ç—‡ç­›æŸ¥é‡è¡¨</h3>
                                    <p>2024-12-05 10:15</p>
                                </div>
                                <button class="btn-view" type="button" data-report-type="sas" data-report-date="2024-12-05 10:15">æŸ¥çœ‹æŠ¥å‘Š</button>
                            </div>
                            <div class="history-item">
                                <div class="history-icon pink">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="history-info">
                                    <h3>å‹åŠ›æ„ŸçŸ¥é‡è¡¨</h3>
                                    <p>2024-11-28 16:45</p>
                                </div>
                                <button class="btn-view" type="button" data-report-type="stress" data-report-date="2024-11-28 16:45">æŸ¥çœ‹æŠ¥å‘Š</button>
                            </div>
                            <div class="history-item">
                                <div class="history-icon pink">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="history-info">
                                    <h3>åŒ¹å…¹å ¡ç¡çœ è´¨é‡æŒ‡æ•°</h3>
                                    <p>2024-12-01 09:30</p>
                                </div>
                                <button class="btn-view" type="button" data-report-type="psqi" data-report-date="2024-12-01 09:30">æŸ¥çœ‹æŠ¥å‘Š</button>
                            </div>
                            <div class="history-item">
                                <div class="history-icon pink">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="history-info">
                                    <h3>SCL-90 å¿ƒç†å¥åº·è‡ªè¯„</h3>
                                    <p>2024-11-25 15:00</p>
                                </div>
                                <button class="btn-view" type="button" data-report-type="scl90" data-report-date="2024-11-25 15:00">æŸ¥çœ‹æŠ¥å‘Š</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§æ¬¡è¦å†…å®¹ -->
                <div class="profile-sidebar">
                    <!-- æˆå°±å‹‹ç«  -->
                    <div class="achievements-section">
                        <h2>æˆå°±å‹‹ç« </h2>
                        <div class="achievements-grid-sidebar">
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon purple">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <h3>åˆå¿ƒè€…</h3>
                                <p>å®Œæˆç¬¬ä¸€æ¬¡æ‰“å¡</p>
                                <span class="date">2024-12-01</span>
                            </div>
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon blue">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <h3>åšæŒè€…</h3>
                                <p>è¿ç»­æ‰“å¡7å¤©</p>
                                <span class="date">2024-12-05</span>
                            </div>
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon green">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <h3>å‘¼å¸å¤§å¸ˆ</h3>
                                <p>å®Œæˆ10æ¬¡å‘¼å¸ç»ƒä¹ </p>
                                <span class="date">2024-12-08</span>
                            </div>
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon purple">
                                    <i class="fas fa-om"></i>
                                </div>
                                <h3>å†¥æƒ³è¾¾äºº</h3>
                                <p>ç´¯è®¡å†¥æƒ³60åˆ†é’Ÿ</p>
                                <span class="date">2024-12-10</span>
                            </div>
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon blue">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <h3>æƒ…ç»ªç®¡ç†å¸ˆ</h3>
                                <p>è¿ç»­æ‰“å¡30å¤©</p>
                                <span class="date">2024-12-15</span>
                            </div>
                            <div class="achievement-card unlocked">
                                <div class="achievement-icon green">
                                    <i class="fas fa-star"></i>
                                </div>
                                <h3>å¿ƒç†æ¢ç´¢è€…</h3>
                                <p>å®Œæˆ5é¡¹æµ‹è¯„</p>
                                <span class="date">2024-12-18</span>
                            </div>
                        </div>
                    </div>

                    <!-- å¿ƒç†æ´åŠ©çƒ­çº¿ -->
                    <div class="hotline-section">
                        <h2>å¿ƒç†æ´åŠ©çƒ­çº¿</h2>
                        <div class="hotline-card-large">
                            <i class="fas fa-phone-volume"></i>
                            <h3>24å°æ—¶ä¸“ä¸šå’¨è¯¢</h3>
                            <p class="hotline-number-large">010-82951332</p>
                            <p class="hotline-desc">å¦‚é‡ç´§æ€¥æƒ…å†µï¼Œè¯·ç«‹å³æ‹¨æ‰“</p>
                            <button class="btn-call">
                                <i class="fas fa-phone-alt"></i> æ‹¨æ‰“çƒ­çº¿
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-backdrop"></div>
        <div class="settings-container">
            <div class="settings-header">
                <h2><i class="fas fa-cog"></i> ä¸ªäººè®¾ç½®</h2>
                <button class="settings-close" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-body">
                <div class="settings-section">
                    <h3>ä¸ªäººä¿¡æ¯</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label><i class="fas fa-camera"></i> å¤´åƒ</label>
                            <div class="avatar-upload">
                                <div class="avatar-preview" id="avatarPreview">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="avatar-actions">
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                    <button type="button" class="btn-upload-avatar" id="uploadAvatarBtn">
                                        <i class="fas fa-upload"></i> ä¸Šä¼ å¤´åƒ
                                    </button>
                                    <p class="avatar-tip">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæœ€å¤§2MB</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> æ˜µç§°</label>
                            <input type="text" id="userNickname" placeholder="è¯·è¾“å…¥æ˜µç§°" value="æƒ…ç»ªå²›å±…æ°‘">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> æ‰‹æœºå·</label>
                            <input type="tel" id="userPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="138****8888">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-birthday-cake"></i> ç”Ÿæ—¥</label>
                            <input type="date" id="userBirthday" value="1995-06-15">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-venus-mars"></i> æ€§åˆ«</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="male">
                                    <span>ç”·</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="female" checked>
                                    <span>å¥³</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="other">
                                    <span>å…¶ä»–</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-footer">
                <button class="btn-save-settings" id="saveSettings">
                    <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
    </div>

    <!-- æµ‹è¯„æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div class="report-modal" id="reportModal">
        <div class="report-backdrop"></div>
        <div class="report-container">
            <!-- æŠ¥å‘Šå¤´éƒ¨ -->
            <div class="report-header">
                <div class="report-title-section">
                    <div class="report-icon" id="reportIcon">
                        <i class="fas fa-cloud-rain"></i>
                    </div>
                    <div>
                        <h2 id="reportTitle">SDS æŠ‘éƒè‡ªè¯„é‡è¡¨</h2>
                        <p class="report-subtitle">äº†è§£æ‚¨çš„æŠ‘éƒçŠ¶å†µï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·</p>
                    </div>
                </div>
                <button class="report-close" id="closeReport">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- æŠ¥å‘Šä¸»ä½“å†…å®¹ -->
            <div class="report-body">
                <!-- å¾—åˆ†å¡ç‰‡ -->
                <div class="report-score-card">
                    <div class="score-icon" id="scoreIcon">
                        <i class="fas fa-cloud-rain"></i>
                    </div>
                    <div class="score-number" id="reportScore">65</div>
                    <div class="score-label" id="reportLevel">ä¸­åº¦æŠ‘éƒ</div>
                </div>

                <!-- ç»“æœåˆ†æ -->
                <div class="report-result-section">
                    <h3><i class="fas fa-clipboard-check"></i> ç»“æœåˆ†æ</h3>
                    <div class="result-text" id="resultContent">
                        æ‚¨ç›®å‰å¤„äºä¸­åº¦æŠ‘éƒçŠ¶æ€ã€‚å»ºè®®æ‰¾å¿ƒç†ä¸“å®¶å’¨è¯¢ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šç»å¸¸æ„Ÿåˆ°æƒ…ç»ªæ¶ˆæ²‰éƒé—·ã€è¦å“­æˆ–æƒ³å“­ã€å¤œé—´ç¡çœ ä¸å¥½ã€ä½“é‡å‡è½»ã€ä¾¿ç§˜ã€æ„Ÿåˆ°å¿ƒè·³åŠ å¿«ã€æ„Ÿåˆ°ç–²åŠ³ã€åå§ä¸å®‰ã€å®¹æ˜“æ¿€æ€’ã€æƒ³åˆ°æ­»ã€‚å»ºè®®æ‚¨ç§¯æå¯»æ±‚å¿ƒç†å’¨è¯¢ï¼Œå­¦ä¹ æƒ…ç»ªç®¡ç†æŠ€å·§ï¼ŒåŒæ—¶ä¿æŒè§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨ã€‚
                    </div>
                </div>
                
                <!-- å› å­åˆ†æï¼ˆä»…å¤šå› å­é‡è¡¨æ˜¾ç¤ºï¼‰ -->
                <div class="report-factor-section" id="reportFactorSection" style="display: none;">
                    <h3><i class="fas fa-th-list"></i> å› å­åˆ†æ</h3>
                    <div class="factor-grid" id="reportFactorGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨æµ®åŠ¨AIåŠ©æ‰‹æŒ‰é’® -->
    <button class="floating-ai-btn" id="floatingAIBtn" title="ä¸AIåŠ©æ‰‹å¯¹è¯" onclick="location.href='ai-chat.html'">
        <i class="fas fa-comments"></i>
        <span class="pulse-ring"></span>
    </button>

    <!-- å¼•å…¥ Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- æµ‹è¯„æŠ¥å‘Šå¤„ç†è„šæœ¬ -->
    <script>
        // æ¨¡æ‹Ÿçš„æµ‹è¯„æ•°æ®åº“
        const mockReportData = {
            sds: {
                title: 'SDS æŠ‘éƒè‡ªè¯„é‡è¡¨',
                subtitle: 'äº†è§£æ‚¨çš„æŠ‘éƒçŠ¶å†µï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·',
                icon: 'fa-cloud-rain',
                score: 65,
                levelText: 'ä¸­åº¦æŠ‘éƒ',
                result: 'æ‚¨ç›®å‰å¤„äºä¸­åº¦æŠ‘éƒçŠ¶æ€ã€‚å»ºè®®æ‰¾å¿ƒç†ä¸“å®¶å’¨è¯¢ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šç»å¸¸æ„Ÿåˆ°æƒ…ç»ªæ¶ˆæ²‰éƒé—·ã€è¦å“­æˆ–æƒ³å“­ã€å¤œé—´ç¡çœ ä¸å¥½ã€ä½“é‡å‡è½»ã€ä¾¿ç§˜ã€æ„Ÿåˆ°å¿ƒè·³åŠ å¿«ã€æ„Ÿåˆ°ç–²åŠ³ã€åå§ä¸å®‰ã€å®¹æ˜“æ¿€æ€’ã€æƒ³åˆ°æ­»ã€‚å»ºè®®æ‚¨ç§¯æå¯»æ±‚å¿ƒç†å’¨è¯¢ï¼Œå­¦ä¹ æƒ…ç»ªç®¡ç†æŠ€å·§ï¼ŒåŒæ—¶ä¿æŒè§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨ã€‚'
            },
            sas: {
                title: 'SAS ç„¦è™‘è‡ªè¯„é‡è¡¨',
                subtitle: 'äº†è§£æ‚¨çš„ç„¦è™‘çŠ¶å†µï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·',
                icon: 'fa-heartbeat',
                score: 58,
                levelText: 'è½»åº¦ç„¦è™‘',
                result: 'æ‚¨ç›®å‰å¤„äºè½»åº¦ç„¦è™‘çŠ¶æ€ã€‚å»ºè®®è¿›è¡Œè‡ªæˆ‘è°ƒèŠ‚ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šæ„Ÿåˆ°ç´§å¼ ä¸å®‰ã€å®¹æ˜“æ‹…å¿ƒã€åç«‹ä¸å®‰ã€æ„Ÿåˆ°ç–²ä¹ã€æ³¨æ„åŠ›éš¾ä»¥é›†ä¸­ã€æ˜“æ€’ã€è‚Œè‚‰ç´§å¼ ã€ç¡çœ å›°éš¾ã€‚å»ºè®®æ‚¨æ¯å¤©ç»ƒä¹ æ·±å‘¼å¸å’Œæ­£å¿µå†¥æƒ³ï¼Œå‡å°‘å’–å•¡å› æ‘„å…¥ï¼Œåˆç†å®‰æ’å·¥ä½œå’Œä¼‘æ¯æ—¶é—´ï¼Œç»™è‡ªå·±ç•™å‡ºæ”¾æ¾çš„æ—¶é—´ã€‚'
            },
            stress: {
                title: 'APESK-PSTR å¿ƒç†å‹åŠ›é‡è¡¨',
                subtitle: 'äº†è§£æ‚¨çš„å‹åŠ›çŠ¶å†µï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·',
                icon: 'fa-brain',
                score: 72,
                levelText: 'ä¸­ç­‰å‹åŠ›',
                result: 'æ‚¨ç›®å‰æ‰¿å—ç€ä¸­ç­‰ç¨‹åº¦çš„å¿ƒç†å‹åŠ›ã€‚å»ºè®®å­¦ä¹ å‹åŠ›ç®¡ç†æŠ€å·§ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šå·¥ä½œä»»åŠ¡è¾ƒé‡ã€æ—¶é—´å‹åŠ›å¤§ã€äººé™…å…³ç³»ç´§å¼ ã€å·¥ä½œç”Ÿæ´»å¤±è¡¡ã€æ˜“çƒ¦èºç„¦è™‘ã€ç¡çœ è´¨é‡ä¸‹é™ã€‚å»ºè®®æ‚¨åˆ—å‡ºä»»åŠ¡æ¸…å•åˆ†æ¸…è½»é‡ç¼“æ€¥ï¼Œå­¦ä¹ å¹¶å®è·µæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾å’Œå†¥æƒ³ï¼Œè®¾ç½®æ˜ç¡®çš„å·¥ä½œè¾¹ç•Œä¿è¯ä¼‘æ¯æ—¶é—´ï¼Œå¿…è¦æ—¶å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢ã€‚'
            },
            psqi: {
                title: 'PSQI åŒ¹å…¹å ¡ç¡çœ è´¨é‡æŒ‡æ•°',
                subtitle: 'äº†è§£æ‚¨çš„ç¡çœ è´¨é‡ï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·',
                icon: 'fa-bed',
                score: 12,
                levelText: 'ç¡çœ è´¨é‡è¾ƒå·®',
                result: 'æ‚¨çš„ç¡çœ è´¨é‡è¾ƒå·®ã€‚å»ºè®®æ”¹å–„ç¡çœ ä¹ æƒ¯ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šå…¥ç¡å›°éš¾ã€ç¡çœ æ—¶é—´çŸ­ã€ç¡çœ æ•ˆç‡ä½ã€ç™½å¤©åŠŸèƒ½å—å½±å“ã€æ˜“é†’å¤šæ¢¦ã€‚å»ºè®®æ‚¨æ¯å¤©å›ºå®šæ—¶é—´ä¸ŠåºŠèµ·åºŠï¼ˆåŒ…æ‹¬å‘¨æœ«ï¼‰ï¼Œç¡®ä¿å§å®¤å®‰é™é»‘æš—å‡‰çˆ½ï¼Œç¡å‰1å°æ—¶é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼Œä¸‹åˆ3ç‚¹åé¿å…å’–å•¡å› ï¼Œç¡å‰3å°æ—¶é¿å…å¤§é‡é¥®é£Ÿã€‚'
            },
            scl90: {
                title: 'SCL-90 å¿ƒç†å¥åº·è‡ªè¯„é‡è¡¨',
                subtitle: 'äº†è§£æ‚¨çš„å¿ƒç†å¥åº·çŠ¶å†µï¼Œå®ˆæŠ¤å¿ƒç†å¥åº·',
                icon: 'fa-notes-medical',
                score: 185,
                levelText: 'è½»åº¦ç—‡çŠ¶',
                result: 'æ‚¨çš„å¿ƒç†å¥åº·çŠ¶å†µæ€»ä½“å°šå¯ï¼Œä½†åœ¨æŸäº›æ–¹é¢å­˜åœ¨è½»åº¦ç—‡çŠ¶ã€‚ä¸»è¦é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼šå¶å°”æ„Ÿåˆ°èº«ä½“ä¸é€‚ã€æœ‰æ—¶å‡ºç°å¼ºè¿«æ€§æ€ç»´ã€äººé™…äº¤å¾€ä¸­è¾ƒä¸ºæ•æ„Ÿã€å­˜åœ¨è½»å¾®æŠ‘éƒæƒ…ç»ªã€å¶å°”æ„Ÿåˆ°ç„¦è™‘ã€‚å»ºè®®æ‚¨æ³¨æ„èº«ä½“ç—‡çŠ¶å¯èƒ½ä¸å¿ƒç†å‹åŠ›æœ‰å…³ï¼Œå­¦ä¹ æ”¾æ¾æŠ€å·§ï¼Œå°è¯•æ›´å¼€æ”¾çš„æ²Ÿé€šæ–¹å¼ï¼ŒåŸ¹å…»å…´è¶£çˆ±å¥½å¢åŠ ç§¯æä½“éªŒï¼Œå®šæœŸè¿›è¡Œå¿ƒç†å¥åº·è‡ªæˆ‘è¯„ä¼°ã€‚'
            }
        };

        // åˆå§‹åŒ–æµ‹è¯„æŠ¥å‘ŠåŠŸèƒ½
        async function initAssessmentReports() {
            // åŠ è½½æµ‹è¯„å†å²
            await loadAssessmentHistory();
            
            // åˆå§‹åŒ–æŠ¥å‘Šæ¨¡æ€æ¡†
            initReportModal();
        }
        
        /**
         * åŠ è½½æµ‹è¯„å†å²è®°å½•
         */
        async function loadAssessmentHistory() {
            try {
                const result = await AssessmentAPI.getReportHistory({
                    days: 180,  // è·å–æœ€è¿‘åŠå¹´çš„è®°å½•
                    limit: 20   // æœ€å¤šæ˜¾ç¤º20æ¡
                });
                
                if (result.success && result.data.length > 0) {
                    console.log('âœ… æµ‹è¯„å†å²åŠ è½½æˆåŠŸ:', result.data.length, 'æ¡è®°å½•');
                    updateAssessmentDisplay(result.data);
                } else {
                    console.log('ğŸ“Š æš‚æ— æµ‹è¯„è®°å½•');
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æµ‹è¯„å†å²é”™è¯¯:', error);
            }
        }
        
        /**
         * æ›´æ–°æµ‹è¯„å†å²æ˜¾ç¤º
         */
        function updateAssessmentDisplay(reports) {
            const container = document.getElementById('assessmentHistory');
            if (!container) return;
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            container.innerHTML = '';
            
            reports.forEach(report => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const icon = AssessmentAPI.getTypeIcon(report.type);
                const date = new Date(report.timestamp);
                const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                
                item.innerHTML = `
                    <div class="history-icon pink">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="history-info">
                        <h3>${report.name}</h3>
                        <p>${dateStr}</p>
                    </div>
                    <button class="btn-view" type="button" data-report-id="${report.id}">æŸ¥çœ‹æŠ¥å‘Š</button>
                `;
                
                container.appendChild(item);
            });
        }
        
        /**
         * åˆå§‹åŒ–æŠ¥å‘Šæ¨¡æ€æ¡†
         */
        function initReportModal() {
            const reportModal = document.getElementById('reportModal');
            const closeBtn = document.getElementById('closeReport');
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®ç‚¹å‡»
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('btn-view') || e.target.closest('.btn-view')) {
                    const btn = e.target.classList.contains('btn-view') ? e.target : e.target.closest('.btn-view');
                    const reportId = btn.dataset.reportId;
                    
                    if (reportId) {
                        await showReportDetail(reportId);
                    }
                }
            });
            
            // æ˜¾ç¤ºæŠ¥å‘Šè¯¦æƒ…
            async function showReportDetail(reportId) {
                try {
                    const result = await AssessmentAPI.getReportDetail(reportId);
                    
                    if (result.success) {
                        const report = result.data;
                        
                        // æ›´æ–°æ ‡é¢˜
                        document.getElementById('reportTitle').textContent = report.name;
                        document.querySelector('.report-subtitle').textContent = 'äº†è§£æ‚¨çš„å¿ƒç†å¥åº·çŠ¶å†µ';
                        
                        // æ›´æ–°å›¾æ ‡
                        const icon = AssessmentAPI.getTypeIcon(report.type);
                        document.getElementById('reportIcon').innerHTML = `<i class="fas ${icon}"></i>`;
                        document.getElementById('scoreIcon').innerHTML = `<i class="fas ${icon}"></i>`;
                        
                        // æ›´æ–°å¾—åˆ†å’Œç­‰çº§
                        document.getElementById('reportScore').textContent = report.score;
                        document.getElementById('reportLevel').textContent = report.level || 'è¯„ä¼°ç»“æœ';
                        
                        // æ›´æ–°ç»“æœåˆ†æ
                        document.getElementById('resultContent').textContent = report.analysis || 'æš‚æ— åˆ†æ';
                        
                        // æ˜¾ç¤ºå› å­åˆ†æ•°ï¼ˆå¦‚æœæœ‰ï¼‰
                        displayFactorScores(report.factorScores);
                        
                        // æ˜¾ç¤ºæ¨¡æ€æ¡†
                        reportModal.classList.add('active');
                    } else {
                        alert('æŠ¥å‘ŠåŠ è½½å¤±è´¥: ' + result.message);
                    }
                } catch (error) {
                    console.error('æ˜¾ç¤ºæŠ¥å‘Šé”™è¯¯:', error);
                    alert('æŠ¥å‘ŠåŠ è½½å¤±è´¥');
                }
            }
            
            /**
             * æ˜¾ç¤ºå› å­åˆ†æ•°
             */
            function displayFactorScores(factorScores) {
                const factorSection = document.getElementById('reportFactorSection');
                const factorGrid = document.getElementById('reportFactorGrid');
                
                // å¦‚æœæ²¡æœ‰å› å­åˆ†æ•°ï¼Œéšè—å› å­åˆ†æåŒºåŸŸ
                if (!factorScores || Object.keys(factorScores).length === 0) {
                    factorSection.style.display = 'none';
                    return;
                }
                
                // æ˜¾ç¤ºå› å­åˆ†æåŒºåŸŸ
                factorSection.style.display = 'block';
                factorGrid.innerHTML = '';
                
                // æ¸²æŸ“æ¯ä¸ªå› å­
                for (const [factorName, score] of Object.entries(factorScores)) {
                    const factorCard = document.createElement('div');
                    factorCard.className = 'factor-card';
                    
                    // æ ¹æ®åˆ†æ•°åˆ¤æ–­é¢œè‰²
                    let colorClass = 'normal';
                    if (score >= 3) {
                        colorClass = 'high';
                    } else if (score >= 2) {
                        colorClass = 'medium';
                    }
                    
                    factorCard.innerHTML = `
                        <div class="factor-name">${factorName}</div>
                        <div class="factor-score ${colorClass}">${score.toFixed(2)}</div>
                        <div class="factor-bar">
                            <div class="factor-bar-fill ${colorClass}" style="width: ${(score / 5) * 100}%"></div>
                        </div>
                    `;
                    
                    factorGrid.appendChild(factorCard);
                }
            }
            
            // å…³é—­æ¨¡æ€æ¡†
            function closeModal() {
                reportModal.classList.remove('active');
            }
            
            // äº‹ä»¶ç›‘å¬
            closeBtn.addEventListener('click', closeModal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            document.querySelector('.report-backdrop').addEventListener('click', closeModal);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æµ‹è¯„æŠ¥å‘Š
        window.addEventListener('load', initAssessmentReports);
    </script>
    
    <!-- æƒ…ç»ªå›¾è¡¨ä¸“ç”¨è„šæœ¬ -->
    <script>
        // ç”Ÿæˆ30å¤©æ¨¡æ‹Ÿæ•°æ®ï¼ˆ10åˆ†åˆ¶ï¼Œ8ç§å¿ƒæƒ…ï¼‰
        function generateMockData() {
            const data = [];
            const moods = [
                { name: 'æ‚²ä¼¤', value: 1 },
                { name: 'ç”Ÿæ°”', value: 2 },
                { name: 'éš¾è¿‡', value: 3 },
                { name: 'å°´å°¬', value: 4 },
                { name: 'ç´§å¼ ', value: 5 },
                { name: 'å¹³é™', value: 6 },
                { name: 'å¾®ç¬‘', value: 8 },
                { name: 'å¼€å¿ƒ', value: 10 }
            ];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                // éšæœºç”Ÿæˆå¿ƒæƒ…ï¼Œåå‘ä¸­é«˜åˆ†æ®µ
                const randomIndex = Math.floor(Math.random() * 5) + 3; // ç´¢å¼•3-7ï¼Œå¯¹åº”ç´§å¼ åˆ°å¼€å¿ƒ
                const randomMood = moods[randomIndex];
                
                data.push({
                    date: dateStr,
                    mood: randomMood.name,
                    value: randomMood.value
                });
            }
            return data;
        }

        // ç¡®ä¿æœ‰æ•°æ®ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦å‡çº§åˆ°æ–°çš„10åˆ†åˆ¶ï¼ˆ8ç§å¿ƒæƒ…ï¼‰
        let chartMoodData = [];
        const stored = localStorage.getItem('moodData');
        if (stored) {
            chartMoodData = JSON.parse(stored);
            // æ£€æŸ¥æ˜¯å¦éœ€è¦å‡çº§ï¼šæ•°æ®å°‘äº20æ¡ï¼Œæˆ–è€…æ‚²ä¼¤å€¼ä¸ç­‰äº1ï¼ˆæ—§ç‰ˆæœ¬æ‚²ä¼¤æ˜¯0ï¼‰
            const needsUpgrade = chartMoodData.length < 20 || 
                                (chartMoodData.some(d => d.mood === 'æ‚²ä¼¤' && d.value !== 1));
            if (needsUpgrade) {
                console.log('å‡çº§åˆ°æ–°ç‰ˆ10åˆ†åˆ¶å¿ƒæƒ…æ•°æ®ï¼ˆ8ç§å¿ƒæƒ…ï¼‰...');
                chartMoodData = generateMockData();
                localStorage.setItem('moodData', JSON.stringify(chartMoodData));
            }
        } else {
            chartMoodData = generateMockData();
            localStorage.setItem('moodData', JSON.stringify(chartMoodData));
        }

        // é¢„åŠ è½½å¿ƒæƒ…å›¾æ ‡
        const moodIcons = {
            1: new Image(),
            2: new Image(),
            3: new Image(),
            4: new Image(),
            5: new Image(),
            6: new Image(),
            8: new Image(),
            10: new Image()
        };
        
        moodIcons[1].src = 'img/sorrow.svg';
        moodIcons[2].src = 'img/angry.svg';
        moodIcons[3].src = 'img/sad.svg';
        moodIcons[4].src = 'img/awkward.svg';
        moodIcons[5].src = 'img/nervous.svg';
        moodIcons[6].src = 'img/calm.svg';
        moodIcons[8].src = 'img/smile.svg';
        moodIcons[10].src = 'img/happy.svg';

        // å½“é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å›¾è¡¨
        window.addEventListener('load', function() {
            console.log('å¼€å§‹åˆå§‹åŒ–å›¾è¡¨ï¼ŒChart.jsçŠ¶æ€:', typeof Chart);
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.jsæœªåŠ è½½');
                return;
            }

            const canvas = document.getElementById('emotionChart');
            if (!canvas) {
                console.error('æ‰¾ä¸åˆ°canvaså…ƒç´ ');
                return;
            }

            let currentChart = null;

            // è‡ªå®šä¹‰æ’ä»¶ï¼šåœ¨Yè½´ç»˜åˆ¶å¿ƒæƒ…å›¾æ ‡
            const moodIconPlugin = {
                id: 'moodIconPlugin',
                afterDraw: (chart) => {
                    const ctx = chart.ctx;
                    const yAxis = chart.scales.y;
                    const iconSize = 28;
                    
                    [1, 2, 3, 4, 5, 6, 8, 10].forEach(value => {
                        const y = yAxis.getPixelForValue(value);
                        const x = yAxis.left - iconSize - 10;
                        
                        if (moodIcons[value].complete) {
                            ctx.drawImage(moodIcons[value], x, y - iconSize/2, iconSize, iconSize);
                        }
                    });
                }
            };

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            function updateSummary(period) {
                const days = period === 'week' ? 7 : 30;
                const today = new Date();
                const periodData = [];
                
                // è·å–å¯¹åº”å‘¨æœŸçš„æ•°æ®
                for (let i = 0; i < days; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const moodEntry = chartMoodData.find(entry => entry.date === dateStr);
                    if (moodEntry) {
                        periodData.push(moodEntry.value);
                    }
                }
                
                // å¹³å‡å¿ƒæƒ…
                const avgElement = document.getElementById('averageMood');
                if (periodData.length > 0) {
                    const avg = (periodData.reduce((sum, val) => sum + val, 0) / periodData.length).toFixed(1);
                    avgElement.textContent = avg;
                    avgElement.className = 'value';
                } else {
                    avgElement.textContent = '---';
                    avgElement.className = 'value';
                }
                
                // æœ€ä½³çŠ¶æ€
                const bestElement = document.getElementById('bestMood');
                if (periodData.length > 0) {
                    const best = Math.max(...periodData).toFixed(1);
                    bestElement.textContent = best;
                    bestElement.className = 'value';
                } else {
                    bestElement.textContent = '---';
                    bestElement.className = 'value';
                }
                
                // æ”¹å–„è¶‹åŠ¿
                const trendElement = document.getElementById('trendMood');
                const sortedHistory = [...chartMoodData].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                if (sortedHistory.length >= 2) {
                    const latestValue = sortedHistory[0].value;
                    const previousValue = sortedHistory[1].value;
                    
                    if (latestValue > previousValue) {
                        trendElement.textContent = 'æ”¹å–„ä¸­';
                        trendElement.className = 'value positive';
                    } else if (latestValue < previousValue) {
                        trendElement.textContent = 'ä¸‹é™';
                        trendElement.className = 'value negative';
                    } else {
                        trendElement.textContent = 'ç¨³å®š';
                        trendElement.className = 'value';
                    }
                } else {
                    trendElement.textContent = '---';
                    trendElement.className = 'value';
                }
            }
            
            // åˆ›å»ºå›¾è¡¨å‡½æ•°
            function createChart(period) {
                const days = period === 'week' ? 7 : 30;
                const labels = [];
                const data = [];
                const today = new Date();
                
                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    if (period === 'week') {
                        labels.push((date.getMonth() + 1) + '/' + date.getDate());
                    } else {
                        labels.push(date.getDate() + 'æ—¥');
                    }
                    
                    const moodEntry = chartMoodData.find(entry => entry.date === dateStr);
                    data.push(moodEntry ? moodEntry.value : null);
                }
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateSummary(period);
                
                if (currentChart) {
                    currentChart.destroy();
                }
                
                const ctx = canvas.getContext('2d');
                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'å¿ƒæƒ…æŒ‡æ•°',
                            data: data,
                            borderColor: '#4A90E2',
                            backgroundColor: 'rgba(74, 144, 226, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: period === 'week' ? 6 : 4,
                            pointHoverRadius: period === 'week' ? 8 : 6,
                            pointBackgroundColor: '#4A90E2',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            spanGaps: true
                        }]
                    },
                    plugins: [moodIconPlugin],
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                left: 40
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                titleFont: { size: 14 },
                                bodyFont: { size: 13 },
                                callbacks: {
                                    label: function(context) {
                                        if (context.parsed.y === null) {
                                            return 'å¿ƒæƒ…: æœªæ‰“å¡';
                                        }
                                        const moodLabels = {
                                            1: 'æ‚²ä¼¤',
                                            2: 'ç”Ÿæ°”',
                                            3: 'éš¾è¿‡',
                                            4: 'å°´å°¬',
                                            5: 'ç´§å¼ ',
                                            6: 'å¹³é™',
                                            8: 'å¾®ç¬‘',
                                            10: 'å¼€å¿ƒ'
                                        };
                                        const score = context.parsed.y;
                                        return 'å¿ƒæƒ…: ' + (moodLabels[score] || score + 'åˆ†');
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10,
                                min: 0,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        return '';
                                    },
                                    font: { size: 11 },
                                    color: 'transparent'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)',
                                    drawBorder: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false,
                                    drawBorder: false
                                },
                                ticks: {
                                    font: { size: 11 },
                                    maxRotation: period === 'month' ? 45 : 0,
                                    minRotation: period === 'month' ? 45 : 0
                                }
                            }
                        }
                    }
                });

                console.log('å›¾è¡¨åˆ›å»ºæˆåŠŸï¼Œæ¨¡å¼:', period);
            }

            // åˆå§‹åŒ–ä¸ºå‘¨è§†å›¾
            createChart('week');

            // æŒ‰é’®åˆ‡æ¢äº‹ä»¶
            const tabBtns = document.querySelectorAll('.chart-tabs .tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.dataset.period;
                    createChart(period);
                    console.log('åˆ‡æ¢åˆ°', period, 'è§†å›¾');
                });
            });

            console.log('âœ… å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        });

        // é¢å¤–çš„æŒ‰é’®ç‚¹å‡»ä¿éšœ
        window.addEventListener('load', function() {
            setTimeout(() => {
                const allButtons = document.querySelectorAll('.btn-view');
                console.log('æ‰¾åˆ°æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®æ•°é‡:', allButtons.length);
                allButtons.forEach((btn, index) => {
                    console.log(`æŒ‰é’® ${index + 1}:`, btn.textContent, 'å¯è§æ€§:', btn.offsetParent !== null);
                });
            }, 500);
        });
    </script>
    
    <!-- å¼•å…¥ç”¨æˆ·API -->
    <script src="api/user.js"></script>
    
    <!-- å¼•å…¥ä¸ªäººè®¾ç½®API -->
    <script src="api/profile.js"></script>
    
    <!-- å¼•å…¥æµ‹è¯„æŠ¥å‘ŠAPI -->
    <script src="api/assessment.js"></script>
    
    <!-- ä¸ªäººè®¾ç½®é¡µé¢é€»è¾‘ -->
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ä¸ªäººè®¾ç½®åŠŸèƒ½
        window.addEventListener('load', async function() {
            console.log('ğŸ”„ åˆå§‹åŒ–ä¸ªäººè®¾ç½®é¡µé¢...');
            
            // åŠ è½½ç”¨æˆ·ä¿¡æ¯
            await loadUserProfile();
            
            // åŠ è½½æˆå°±å‹‹ç« 
            await loadAchievements();
            
            // åˆå§‹åŒ–è®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶
            initSettingsModal();
        });
        
        /**
         * åŠ è½½ç”¨æˆ·ä¸ªäººä¿¡æ¯
         */
        async function loadUserProfile() {
            try {
                const result = await ProfileAPI.getUserProfile();
                
                if (result.success) {
                    const profile = result.data;
                    console.log('âœ… ç”¨æˆ·ä¿¡æ¯åŠ è½½æˆåŠŸ:', profile);
                    
                    // æ›´æ–°é¡µé¢ä¸Šçš„ç”¨æˆ·ä¿¡æ¯
                    updateProfileDisplay(profile);
                } else {
                    console.error('âŒ åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½ç”¨æˆ·ä¿¡æ¯é”™è¯¯:', error);
            }
        }
        
        /**
         * æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„ç”¨æˆ·ä¿¡æ¯
         */
        function updateProfileDisplay(profile) {
            // æ›´æ–°é¡¶éƒ¨ä¿¡æ¯
            const daysElement = document.querySelector('.profile-header-new p .highlight');
            if (daysElement) {
                daysElement.textContent = profile.daysFromRegistration;
            }
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            const statCards = document.querySelectorAll('.stat-card-new .stat-number');
            if (statCards.length >= 3) {
                statCards[0].textContent = profile.statistics.totalCheckins; // æ‰“å¡å¤©æ•°
                statCards[1].textContent = profile.statistics.totalPractices; // ç»ƒä¹ æ¬¡æ•°
                statCards[2].textContent = profile.statistics.totalAssessments; // å®Œæˆæµ‹è¯„
            }
            
            // æ›´æ–°è®¾ç½®æ¨¡æ€æ¡†ä¸­çš„ä¿¡æ¯
            const nicknameInput = document.getElementById('userNickname');
            const phoneInput = document.getElementById('userPhone');
            const birthdayInput = document.getElementById('userBirthday');
            const genderInputs = document.querySelectorAll('input[name="gender"]');
            
            if (nicknameInput) nicknameInput.value = profile.nickname;
            if (phoneInput) phoneInput.value = profile.phone;
            if (birthdayInput) birthdayInput.value = profile.birthday;
            
            // è®¾ç½®æ€§åˆ«å•é€‰æ¡†
            genderInputs.forEach(input => {
                if (input.value === profile.gender) {
                    input.checked = true;
                }
            });
            
            // æ›´æ–°å¤´åƒ
            if (profile.avatar) {
                updateAvatarDisplay(profile.avatar);
            }
        }
        
        /**
         * æ›´æ–°å¤´åƒæ˜¾ç¤º
         */
        function updateAvatarDisplay(avatarUrl) {
            const avatarPreview = document.getElementById('avatarPreview');
            if (avatarPreview && avatarUrl) {
                avatarPreview.innerHTML = `<img src="${avatarUrl}" alt="å¤´åƒ" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            }
        }
        
        /**
         * åŠ è½½æˆå°±å‹‹ç« 
         */
        async function loadAchievements() {
            try {
                const result = await ProfileAPI.getAchievements();
                
                if (result.success) {
                    console.log('âœ… æˆå°±å‹‹ç« åŠ è½½æˆåŠŸ');
                    updateAchievementsDisplay(result.data);
                } else {
                    console.error('âŒ åŠ è½½æˆå°±å¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æˆå°±é”™è¯¯:', error);
            }
        }
        
        /**
         * æ›´æ–°æˆå°±å‹‹ç« æ˜¾ç¤º
         */
        function updateAchievementsDisplay(achievements) {
            const achievementsGrid = document.querySelector('.achievements-grid-sidebar');
            if (!achievementsGrid) return;
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            achievementsGrid.innerHTML = '';
            
            // åªæ˜¾ç¤ºå·²è§£é”çš„æˆå°±ï¼ˆå‰6ä¸ªï¼‰
            const unlockedAchievements = achievements.filter(a => a.unlocked).slice(0, 6);
            
            unlockedAchievements.forEach(achievement => {
                const card = document.createElement('div');
                card.className = `achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'}`;
                card.innerHTML = `
                    <div class="achievement-icon ${achievement.color}">
                        <i class="fas ${achievement.icon}"></i>
                    </div>
                    <h3>${achievement.name}</h3>
                    <p>${achievement.description}</p>
                    ${achievement.unlocked ? `<span class="date">${achievement.unlockedDate}</span>` : ''}
                `;
                achievementsGrid.appendChild(card);
            });
        }
        
        /**
         * åˆå§‹åŒ–è®¾ç½®æ¨¡æ€æ¡†
         */
        function initSettingsModal() {
            const settingsModal = document.getElementById('settingsModal');
            const openSettingsBtn = document.querySelector('.btn-settings');
            const closeSettingsBtn = document.getElementById('closeSettings');
            const saveSettingsBtn = document.getElementById('saveSettings');
            const uploadAvatarBtn = document.getElementById('uploadAvatarBtn');
            const avatarInput = document.getElementById('avatarInput');
            
            // æ‰“å¼€è®¾ç½®æ¨¡æ€æ¡†
            if (openSettingsBtn) {
                openSettingsBtn.addEventListener('click', function() {
                    settingsModal.classList.add('active');
                });
            }
            
            // å…³é—­è®¾ç½®æ¨¡æ€æ¡†
            if (closeSettingsBtn) {
                closeSettingsBtn.addEventListener('click', function() {
                    settingsModal.classList.remove('active');
                });
            }
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            const backdrop = document.querySelector('.settings-backdrop');
            if (backdrop) {
                backdrop.addEventListener('click', function() {
                    settingsModal.classList.remove('active');
                });
            }
            
            // ä¸Šä¼ å¤´åƒæŒ‰é’®
            if (uploadAvatarBtn && avatarInput) {
                uploadAvatarBtn.addEventListener('click', function() {
                    avatarInput.click();
                });
                
                avatarInput.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        await handleAvatarUpload(file);
                    }
                });
            }
            
            // ä¿å­˜è®¾ç½®
            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', async function() {
                    await handleSaveSettings();
                });
            }
        }
        
        /**
         * å¤„ç†å¤´åƒä¸Šä¼ 
         */
        async function handleAvatarUpload(file) {
            try {
                console.log('ğŸ“¤ ä¸Šä¼ å¤´åƒ...', file.name);
                
                const result = await ProfileAPI.uploadAvatar(file);
                
                if (result.success) {
                    console.log('âœ… å¤´åƒä¸Šä¼ æˆåŠŸ');
                    updateAvatarDisplay(result.data.avatar);
                    showMessage('å¤´åƒä¸Šä¼ æˆåŠŸï¼', 'success');
                } else {
                    console.error('âŒ å¤´åƒä¸Šä¼ å¤±è´¥:', result.message);
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('âŒ å¤´åƒä¸Šä¼ é”™è¯¯:', error);
                showMessage('å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        
        /**
         * å¤„ç†ä¿å­˜è®¾ç½®
         */
        async function handleSaveSettings() {
            try {
                const nicknameInput = document.getElementById('userNickname');
                const birthdayInput = document.getElementById('userBirthday');
                const genderInput = document.querySelector('input[name="gender"]:checked');
                
                const settings = {
                    nickname: nicknameInput.value.trim(),
                    birthday: birthdayInput.value,
                    gender: genderInput ? genderInput.value : 'female'
                };
                
                console.log('ğŸ’¾ ä¿å­˜è®¾ç½®...', settings);
                
                const result = await ProfileAPI.updateProfile(settings);
                
                if (result.success) {
                    console.log('âœ… è®¾ç½®ä¿å­˜æˆåŠŸ');
                    showMessage('è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                    
                    // é‡æ–°åŠ è½½ç”¨æˆ·ä¿¡æ¯
                    setTimeout(() => {
                        loadUserProfile();
                    }, 500);
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    setTimeout(() => {
                        document.getElementById('settingsModal').classList.remove('active');
                    }, 1000);
                } else {
                    console.error('âŒ ä¿å­˜è®¾ç½®å¤±è´¥:', result.message);
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜è®¾ç½®é”™è¯¯:', error);
                showMessage('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        
        /**
         * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
         */
        function showMessage(message, type = 'info') {
            // åˆ›å»ºæ¶ˆæ¯æç¤ºå…ƒç´ 
            const messageEl = document.createElement('div');
            messageEl.className = `message-toast message-${type}`;
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                padding: 12px 24px;
                background: ${type === 'success' ? '#5FD3A6' : type === 'error' ? '#FF6B9D' : '#4A90E2'};
                color: white;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                animation: slideDown 0.3s ease;
            `;
            
            document.body.appendChild(messageEl);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageEl.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    messageEl.remove();
                }, 300);
            }, 3000);
        }
    </script>
    
    <!-- å¼•å…¥ä¸» JS -->
    <script src="js/main.js"></script>
	</body>
</html>
